<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <style>
  #pie-chart {
    display: block;
    margin: 0 auto;
  }
</style>
</head>

<body>
  <div class="container text-center">
    <div class="row">
      <h2>The Wheel</h2>
    </div>
  </div>


<form id="form">
  <p><strong>Enter up to 10 subjects and values:</strong></p>
  <div id="input-fields">
    <div class="field">
      <label for="subject-1">Success Statement:</label>
      <input type="text" id="subject-1" name="subject-1">
      <label for="value-1">Satisfacion Score:</label>
      <input type="number" id="value-1" name="value-1" min="1" max="10">
    </div>
  </div>
  <button type="button" onclick="addField()">Add another subject</button>
  <input type="submit" value="Generate Chart">
</form>

<svg id="pie-chart" width="1200" height="1200"></svg>

<script src="script.js"></script>

</body>

<script>
  // Track the number of input fields
let fieldCount = 1;

// Add another input field
function addField() {
  if (fieldCount < 10) {
    fieldCount++;
    const inputFields = document.getElementById("input-fields");
    const newField = document.createElement("div");
    newField.classList.add("field");
    newField.innerHTML = `
      <label for="subject-${fieldCount}">Subject:</label>
      <input type="text" id="subject-${fieldCount}" name="subject-${fieldCount}">
      <label for="value-${fieldCount}">Value:</label>
      <input type="number" id="value-${fieldCount}" name="value-${fieldCount}" min="1" max="10">
    `;
    inputFields.appendChild(newField);
  }
}

document.getElementById("form").addEventListener("submit", function (event) {
  event.preventDefault();

  // Get the form data
  const data = [];
  for (let i = 1; i <= fieldCount; i++) {
    const subject = document.getElementById(`subject-${i}`).value;
    const value = document.getElementById(`value-${i}`).value;
    data.push({ subject, value: +value });
  }

  const width = 1200;
  const height = 1200;
  const innerRadius = 10;
  const outerRadius = Math.min(width, height) / 4;
  const fullCircle = 2 * Math.PI;

  // Remove old content before adding new
  d3.select("#pie-chart").html("");

  const svg = d3
    .select("#pie-chart")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("transform", `translate(${width / 2}, ${height / 2})`);

  const color = d3.scaleOrdinal(d3.schemeCategory10);

  const x = d3
    .scaleBand()
    .range([0, fullCircle])
    .align(0)
    .domain(data.map((d) => d.subject));

  const y = d3.scaleLinear().range([innerRadius, outerRadius]).domain([0, 10]);

  const arc = d3
    .arc()
    .innerRadius((d) => y(0))
    .outerRadius((d) => y(d.value))
    .startAngle((d) => x(d.subject))
    .endAngle((d) => x(d.subject) + x.bandwidth())
    .padAngle(0.01)
    .padRadius(innerRadius);

  svg
    .selectAll("path")
    .data(data)
    .enter()
    .append("path")
    .attr("d", arc)
    .attr("fill", (d, i) => color(i));

  const ticks = svg
    .append("g")
    .selectAll("g")
    .data(y.ticks(10).slice(1))
    .enter()
    .append("g");

  ticks
    .append("circle")
    .attr("r", y)
    .attr("stroke", "#ccc")
    .attr("fill", "none");

  svg
    .append("circle")
    .attr("r", outerRadius)
    .attr("stroke", "black")
    .attr("fill", "none");

  // Add labels
  const labelArc = d3
    .arc()
    .innerRadius(outerRadius + 50) // 50 units outside of the outerRadius
    .outerRadius(outerRadius + 50) // 50 units outside of the outerRadius
    .startAngle((d) => x(d.subject))
    .endAngle((d) => x(d.subject) + x.bandwidth());

  // Add labels
  const labels = svg.selectAll(".label").data(data).enter().append("g");

  // Add lines
  labels
    .append("line")
    .attr("x1", function (d) {
      return arc.centroid(d)[0];
    })
    .attr("y1", function (d) {
      return arc.centroid(d)[1];
    })
    .attr("x2", function (d) {
      return labelArc.centroid(d)[0];
    })
    .attr("y2", function (d) {
      return labelArc.centroid(d)[1];
    })
    .style("stroke", "black")
    .style("stroke-width", "1px");

  // // Add rectangles
  // labels
  //   .append("rect")
  //   .attr("x", function (d) {
  //     const midpoint_angle = (x(d.subject) + x(d.subject) + x.bandwidth()) / 2;
  //     return midpoint_angle > Math.PI
  //       ? labelArc.centroid(d)[0]
  //       : labelArc.centroid(d)[0] - 50;
  //   })
  //   .attr("y", function (d) {
  //     return labelArc.centroid(d)[1] - 10;
  //   })
  //   .attr("width", 50)
  //   .attr("height", 20)
  //   .style("fill", "white")


  // Make sure text appears on top of the rectangles
  labels
    .append("text")
    .attr("transform", (d) => `translate(${labelArc.centroid(d)})`)
    .attr("text-anchor", function (d) {
      const midpoint_angle = (x(d.subject) + x(d.subject) + x.bandwidth()) / 2;
      return midpoint_angle > Math.PI ? "end" : "start";
    })
    .attr("dy", ".35em")
    .text((d) => d.subject);
});

//   const labels = svg.selectAll(".label").data(data).enter().append("g");

//   labels
//     .append("text")
//     .attr("transform", (d) => `translate(${labelArc.centroid(d)})`)
//     .attr("dy", ".35em")
//     .text((d) => d.subject);

//   // Add lines
//   labels
//     .append("line")
//     .attr("x1", function (d) {
//       return arc.centroid(d)[0];
//     })
//     .attr("y1", function (d) {
//       return arc.centroid(d)[1];
//     })
//     .attr("x2", function (d) {
//       return labelArc.centroid(d)[0];
//     })
//     .attr("y2", function (d) {
//       return labelArc.centroid(d)[1];
//     })
//     .style("stroke", "black")
//     .style("stroke-width", "1px");

//   labels
//     .append("rect")
//     .attr("x", function (d) {
//       return labelArc.centroid(d)[0] - 25;
//     })
//     .attr("y", function (d) {
//       return labelArc.centroid(d)[1] - 10;
//     })
//     .attr("width", 50)
//     .attr("height", 20)
//     .style("fill", "white");

//   // Make sure text appears on top of the rectangles
//   labels
//     .append("text")
//     .attr("transform", (d) => `translate(${labelArc.centroid(d)})`)
//     .attr("dy", ".35em")
//     .text((d) => d.subject);
// });

</script>
</html>
